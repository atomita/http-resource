var _ns_={id:"atomita.http.request",doc:"http request module"},superagent=require("superagent"),bluebird=require("bluebird"),lodash=require("lodash"),request=function(r,e,n,t,u){return t=t||{},u=u||Object,bluebird.resolve().then(function(){return new bluebird(function(u,o){return function(){var s=superagent(r.toLowerCase(),e);return lodash.has(t,"query")?s.query(t.query):void 0,lodash.has(t,"header")?s.set(t.header):void 0,s.send(n).end(function(r,e){return r||!e.ok?o(r||newError("undefined error.",e,r)):u(e)})}.call(this)})}).then(function(r){return new bluebird(function(e,n){return t.isArray?lodash.isArray(r.body)?e(r):n(newError("Is not Array.",r)):lodash.isObject(r.body)?e(r):n(newError("Is not Object.",r))})}).then(function(r){return new bluebird(function(e,n){return e(t.isArray?lodash.map(function(e){return new u(e,r)}):new u(r.body,r))})})};module.exports=request;var newError=function(r,e,n){return function(){var t=new Error(r);return lodash.extend(t,{original:n,response:e,status:e?e.status:null})}.call(this)};